# 操作系统启动过程
## BIOS和主引导记录MBR
- 实模式和保护模式
    - 实模式（实地址模式，REAL MODE）
        - 程序按照8086寻址方法访问0h-FFFFFh（1MB）空间
        - 寻址方式：物理地址（20位）=段地址：偏移地址
        - CPU单任务运行
    - 保护模式（内存保护模式，PROTECT MODE）
        - 寻址方式：段（32位）和偏移量（32位），寻址4GB空间
        - 段的属性：起始地址，存取属性，权限级别
        - 段页式寻址机制
        - 虚拟地址，进程，封闭空间
        - 应用程序和操作系统的运行环境都被保护
        - CPU支持多任务
    - 实模式存取的1M空间
        - 前面640K：基本内存
        - 中间128K：显卡显存
        - 末尾258K：系统BIOS
    - 系统BIOS（Basic I/O System）固件
        - 基本输入/输出系统
        - 位置位于F0000-FFFFF
        - 功能：
            - 系统启动配置
                - CMOS设置
            - 基本的设备I/O服务
                - BIOS使用的中断类型号为10H-1FH
            - 系统的加电自检和启动
                - 初始化基本硬件CPU/内存/显卡
                - 按下电源键或复位键后执行的第一条指令
                    - 执行FFFF0处的指令（和CS：IP有关）
                    - JUMP POST
                    - 查找显卡BIOS，调用显卡BIOS
                    - 依次查找其他设备执行相应设置的BIOS
                    - 显示启动画面
                    - 从硬盘/软盘/光驱/U盘读入OS
                    - OS启动后，由OS接管计算机
    - 主启动记录MBR
        - 存放在硬盘/软盘的首扇区
        - 存放和OS启动的相关信息（Main Boot Record） 
        - 512 BYTES
        - 结束：0xAA55
    - MBR/硬盘分区/格式化
    - BIOS和MBR程序运行过程
        - POST-CMOS设置（硬盘启动）-读取MBR-控制权交给MBR
        - MBR读取分区表，找到其中的活动分区，并确认其他的分区都不是活动分区，MBR读取活动分区的第一个分区
        - PBR继续控制后面的引导过程

## 操作系统的启动
- 启动过程
    - 从加电到用户工作环境准备好的过程
        1. 初始引导
        2. 核心初始化
        3. 系统初始化
    - 初始引导
        - 目的：把OS核心装入内存并使之开始工作接管计算机系统
        - 过程：
            - 加电，JUMP POST
            - BIOS中的启动程序运行
            - 启动程序：读取0面0道1扇区内容，加载MBR**引导程序**
            - 引导程序：根据相关参数，读取硬盘指定位置的文件到内存，加载硬盘上的**OS内核**，并初始化基本数据
    - 核心初始化
    - 系统初始化
        - 为用户使用系统做准备，使系统处于待命状态
        - 初始化文件系统、网络系统、控制台、图形界面
- Windows的启动过程
    - POST 加电后BIOS启动主机自检程序
    - 初始引导 读入引导程序
    - 核心初始化
    - 系统初始化 GUI界面生成，系统处于待命/消息接收状态
- Linux的启动过程
    - POST-MBR-KERNEL映像-KERNEL映像自解压并执行（边解压边执行）-内核初始化-内核启动
    - KERNEL映像是一个zlib压缩过的内核映像
    - KERNEL映像前端是一个可执行例程
    - 内核完成引导后，加载init程序
        - 进程号1
        - init进程通过/etc/inittab脚本进行初始化
        - 脚本文件/etc/inittab：设置键盘、字体、装载模块、设置网络等

# 操作系统的生成
- 满足特定的硬件环境和用户需要，组装和构建操作系统过程
- OS生成的主要步骤
    - 根据硬件环境/用户要求配置功能模块和构造参数
    - ==构建（build）OS的映像==
- 操作系统生成的前提
    - 由可拆装模块构成
    - 有交互配置工具
    - 有映像构建（build）工具
- Linux操作系统生成
    1. 获取[Linux内核的源代码](https://www.kernel.org/)
    2. 选择和启动内核配置程序
    3. 根据需要配置内核模块和参数
    4. 重新编译新的内核
    5. 编译和安装模块
    6. 启动新内核
- 参考网址
    - [ubantu12.04的系统Linux2.6.30](https://blog.csdn.net/xiaocainiaoshangxiao/article/details/219312801)
    - [Fedora下内核编译](https://www.linuxidc.com/Linux/2011-01/31456.htm)
    - [Fedora内核更新](https://www.2cto.com/os/201204/125945.html)